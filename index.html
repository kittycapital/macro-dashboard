<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê¸€ë¡œë²Œ ë§¤í¬ë¡œ ëŒ€ì‹œë³´ë“œ</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;500;700&family=Bebas+Neue&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
:root {
  --bg: #000000;
  --card: #0a0a0e;
  --card-border: #151520;
  --card-hover: #0e0e15;
  --text: #e4e4ee;
  --text2: #6e6e88;
  --text3: #3a3a52;
  --blue: #4a9eff;
  --cyan: #00e5cc;
  --red: #ff4a6a;
  --orange: #ff8c42;
  --yellow: #ffd642;
  --green: #42ff8c;
  --purple: #a855f7;
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Noto Sans KR', -apple-system, sans-serif;
  -webkit-font-smoothing: antialiased;
}

.wrap { max-width:1400px; margin:0 auto; padding:20px 24px 40px; }

/* â”€â”€ Header â”€â”€ */
.hdr { display:flex; align-items:center; justify-content:space-between; margin-bottom:28px; padding-bottom:18px; border-bottom:1px solid var(--card-border); }
.hdr-left { display:flex; align-items:center; gap:14px; }
.logo { width:40px; height:40px; background:linear-gradient(135deg,var(--blue),var(--cyan)); border-radius:9px; display:flex; align-items:center; justify-content:center; font-size:18px; font-weight:900; color:#000; font-family:'Bebas Neue',sans-serif; }
.hdr h1 { font-size:20px; font-weight:900; letter-spacing:-0.5px; }
.hdr h1 span { display:block; font-size:11px; font-weight:400; color:var(--text2); margin-top:1px; letter-spacing:0; }
.hdr-right { text-align:right; font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--text3); }
.hdr-right strong { color:var(--cyan); font-weight:500; }
.live { display:inline-block; width:7px; height:7px; background:var(--green); border-radius:50%; margin-right:5px; animation:pulse 2s infinite; }
@keyframes pulse { 0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(66,255,140,.5)} 50%{opacity:.6;box-shadow:0 0 0 5px rgba(66,255,140,0)} }

/* â”€â”€ Grid â”€â”€ */
.grid { display:grid; grid-template-columns:repeat(12,1fr); gap:14px; }

/* â”€â”€ Card â”€â”€ */
.card {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: 12px;
  padding: 18px 20px 16px;
  position: relative;
  overflow: hidden;
  animation: fadeUp .5s ease both;
}
.card:nth-child(1){animation-delay:.05s} .card:nth-child(2){animation-delay:.08s}
.card:nth-child(3){animation-delay:.11s} .card:nth-child(4){animation-delay:.14s}
.card:nth-child(5){animation-delay:.17s} .card:nth-child(6){animation-delay:.20s}
.card:nth-child(7){animation-delay:.23s}
@keyframes fadeUp { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }

.card-label { font-family:'JetBrains Mono',monospace; font-size:10px; font-weight:500; color:var(--text3); text-transform:uppercase; letter-spacing:1.5px; margin-bottom:4px; }
.card-title { font-size:15px; font-weight:700; margin-bottom:2px; display:flex; align-items:center; gap:7px; }
.card-desc { font-size:11.5px; color:var(--text2); margin-bottom:14px; line-height:1.5; }

/* â”€â”€ Period Tabs â”€â”€ */
.tabs { display:flex; gap:4px; margin-bottom:14px; flex-wrap:wrap; }
.tab {
  padding:5px 12px;
  border-radius:6px;
  font-family:'JetBrains Mono',monospace;
  font-size:10.5px;
  font-weight:500;
  color:var(--text3);
  background:transparent;
  border:1px solid transparent;
  cursor:pointer;
  transition:all .2s;
  user-select:none;
}
.tab:hover { color:var(--text2); background:rgba(255,255,255,.03); }
.tab.active { color:var(--cyan); background:rgba(0,229,204,.08); border-color:rgba(0,229,204,.2); }

/* â”€â”€ Stat Cards Row â”€â”€ */
.stats { display:flex; gap:10px; margin-bottom:14px; flex-wrap:wrap; }
.stat {
  background:rgba(255,255,255,.02);
  border:1px solid var(--card-border);
  border-radius:8px;
  padding:10px 14px;
  min-width:0;
  flex:1;
}
.stat-flag { font-size:16px; margin-bottom:2px; }
.stat-val { font-family:'JetBrains Mono',monospace; font-size:20px; font-weight:700; line-height:1.2; }
.stat-sub { font-size:10px; color:var(--text2); margin-top:1px; }
.stat-chg { font-family:'JetBrains Mono',monospace; font-size:11px; font-weight:600; margin-top:2px; }
.up { color:var(--green); } .dn { color:var(--red); } .flat { color:var(--text3); }

/* â”€â”€ Chart Container â”€â”€ */
.chart-wrap { position:relative; width:100%; }
.chart-wrap canvas { width:100%!important; }

/* â”€â”€ Span â”€â”€ */
.s12{grid-column:span 12} .s8{grid-column:span 8} .s7{grid-column:span 7}
.s6{grid-column:span 6} .s5{grid-column:span 5} .s4{grid-column:span 4}

/* â”€â”€ Yield Curve Special â”€â”€ */
.yc-legend { display:flex; gap:16px; margin-bottom:8px; flex-wrap:wrap; }
.yc-leg { display:flex; align-items:center; gap:6px; font-size:11px; color:var(--text2); }
.yc-dot { width:10px; height:3px; border-radius:2px; }
.spread-box { display:flex; gap:12px; margin-top:10px; flex-wrap:wrap; }
.spread-item { display:flex; align-items:center; gap:6px; }
.spread-val { font-family:'JetBrains Mono',monospace; font-size:13px; font-weight:600; }
.spread-name { font-size:10px; color:var(--text2); }
.badge { display:inline-flex; align-items:center; gap:4px; padding:3px 8px; border-radius:12px; font-family:'JetBrains Mono',monospace; font-size:9.5px; font-weight:600; }
.badge-red { background:rgba(255,74,106,.1); color:var(--red); }
.badge-green { background:rgba(66,255,140,.1); color:var(--green); }
.badge-blue { background:rgba(74,158,255,.1); color:var(--blue); }
.badge-yellow { background:rgba(255,214,66,.1); color:var(--yellow); }

/* â”€â”€ Interpretation Box â”€â”€ */
.interp {
  margin-top:12px;
  padding:10px 14px;
  border-radius:8px;
  font-size:11.5px;
  line-height:1.5;
}
.interp-green { background:rgba(66,255,140,.05); border:1px solid rgba(66,255,140,.12); color:var(--green); }
.interp-red { background:rgba(255,74,106,.05); border:1px solid rgba(255,74,106,.12); color:var(--red); }
.interp-blue { background:rgba(74,158,255,.05); border:1px solid rgba(74,158,255,.12); color:var(--blue); }
.interp-yellow { background:rgba(255,214,66,.05); border:1px solid rgba(255,214,66,.12); color:var(--yellow); }
.interp strong { font-weight:700; }

/* â”€â”€ Footer â”€â”€ */
.ftr { margin-top:24px; padding-top:14px; border-top:1px solid var(--card-border); display:flex; justify-content:space-between; flex-wrap:wrap; gap:8px; font-size:10px; color:var(--text3); }
.ftr a { color:var(--blue); text-decoration:none; }

/* â”€â”€ Responsive â”€â”€ */
@media(max-width:1100px) {
  .s8,.s7,.s6,.s5,.s4 { grid-column:span 12; }
}
@media(max-width:600px) {
  .wrap { padding:14px 12px 32px; }
  .grid { gap:10px; }
  .card { padding:14px 14px 12px; }
  .hdr { flex-direction:column; align-items:flex-start; gap:8px; }
  .hdr-right { text-align:left; }
  .stats { gap:6px; }
  .stat { padding:8px 10px; }
  .stat-val { font-size:16px; }
  .card-title { font-size:14px; }
}
</style>
</head>
<body>

<div class="wrap">

  <!-- Header -->
  <header class="hdr">
    <div class="hdr-left">
      <div class="logo">M</div>
      <h1>ê¸€ë¡œë²Œ ë§¤í¬ë¡œ ëŒ€ì‹œë³´ë“œ<span>Global Macro Dashboard Â· FRED & OECD Data</span></h1>
    </div>
    <div class="hdr-right">
      <span class="live"></span><strong>LIVE</strong><br>
      <span id="lastUpdate">2025.02.06</span> ì—…ë°ì´íŠ¸
    </div>
  </header>

  <!-- Grid -->
  <div class="grid">

    <!-- â•â•â• 1. Global M2 â•â•â• -->
    <div class="card s8" id="m2Card">
      <div class="card-label">GLOBAL LIQUIDITY</div>
      <div class="card-title">ğŸ’§ ê¸€ë¡œë²Œ M2 í†µí™”ëŸ‰</div>
      <div class="card-desc">ì „ì„¸ê³„ ì¤‘ì•™ì€í–‰ì´ ê³µê¸‰í•œ ìœ ë™ì„± ì´ëŸ‰. M2 ì¦ê°€ â†’ ìì‚°ì‹œì¥ ìƒìŠ¹ ì••ë ¥</div>
      <div class="tabs" id="m2ModeTabs">
        <div class="tab active" data-mode="total">í•©ì‚°</div>
        <div class="tab" data-mode="countries">êµ­ê°€ë³„</div>
      </div>
      <div class="tabs" id="m2Tabs">
        <div class="tab" data-period="3m">3M</div>
        <div class="tab" data-period="1y">1Y</div>
        <div class="tab active" data-period="5y">5Y</div>
        <div class="tab" data-period="all">ALL</div>
      </div>
      <div class="stats" id="m2Stats"></div>
      <div class="chart-wrap"><canvas id="m2Chart" height="200"></canvas></div>
    </div>

    <!-- â•â•â• 2. Fed Balance Sheet â•â•â• -->
    <div class="card s4" id="fedCard">
      <div class="card-label">FED BALANCE SHEET</div>
      <div class="card-title">ğŸ›ï¸ ì—°ì¤€ ëŒ€ì°¨ëŒ€ì¡°í‘œ</div>
      <div class="card-desc">ì—°ì¤€ì´ ë³´ìœ í•œ ìì‚° ê·œëª¨. ì¤„ë©´ ê¸´ì¶•(QT), ëŠ˜ë©´ ì™„í™”(QE)</div>
      <div class="tabs" id="fedTabs">
        <div class="tab" data-period="1m">1M</div>
        <div class="tab" data-period="1y">1Y</div>
        <div class="tab active" data-period="5y">5Y</div>
        <div class="tab" data-period="all">ALL</div>
      </div>
      <div class="stats" id="fedStats"></div>
      <div class="chart-wrap"><canvas id="fedChart" height="180"></canvas></div>
    </div>

    <!-- â•â•â• 3. Yield Curve â•â•â• -->
    <div class="card s6" id="ycCard">
      <div class="card-label">US TREASURY YIELD CURVE</div>
      <div class="card-title">ğŸ“ ë¯¸êµ­ ì¼ë“œì»¤ë¸Œ</div>
      <div class="card-desc">ë¯¸êµ­ êµ­ì±„ ë§Œê¸°ë³„ ê¸ˆë¦¬. ì—­ì „(ë‹¨ê¸°>ì¥ê¸°) ì‹œ ê²½ê¸°ì¹¨ì²´ ì‹ í˜¸</div>
      <div class="yc-legend">
        <div class="yc-leg"><div class="yc-dot" style="background:var(--orange)"></div>í˜„ì¬</div>
        <div class="yc-leg"><div class="yc-dot" style="background:var(--purple);opacity:.5"></div>1ë…„ ì „</div>
      </div>
      <div class="chart-wrap"><canvas id="ycChart" height="200"></canvas></div>
      <div class="spread-box" id="ycSpreads"></div>
    </div>

    <!-- â•â•â• 4. NFCI â•â•â• -->
    <div class="card s6" id="nfciCard">
      <div class="card-label">CHICAGO FED NFCI</div>
      <div class="card-title">ğŸŒ¡ï¸ ê¸ˆìœµìƒí™©ì§€ìˆ˜</div>
      <div class="card-desc">ì‹œì¹´ê³ ì—°ì¤€ NFCI. 0 ì´ìƒì´ë©´ ê¸´ì¶•ì , ì´í•˜ë©´ ì™„í™”ì  ê¸ˆìœµí™˜ê²½</div>
      <div class="tabs" id="nfciTabs">
        <div class="tab" data-period="1y">1Y</div>
        <div class="tab active" data-period="3y">3Y</div>
        <div class="tab" data-period="5y">5Y</div>
        <div class="tab" data-period="all">ALL</div>
      </div>
      <div class="stats" id="nfciStats"></div>
      <div class="chart-wrap"><canvas id="nfciChart" height="200"></canvas></div>
      <div class="interp" id="nfciInterp"></div>
    </div>

    <!-- â•â•â• 5. Interest Rates â•â•â• -->
    <div class="card s7" id="ratesCard">
      <div class="card-label">CENTRAL BANK RATES</div>
      <div class="card-title">ğŸ¦ G7 + í•œêµ­ ê¸°ì¤€ê¸ˆë¦¬</div>
      <div class="card-desc">ì£¼ìš”êµ­ ì¤‘ì•™ì€í–‰ ê¸°ì¤€ê¸ˆë¦¬ ì¶”ì´. ê¸€ë¡œë²Œ í†µí™”ì •ì±… ë°©í–¥ í™•ì¸</div>
      <div class="tabs" id="ratesTabs">
        <div class="tab" data-period="3y">3Y</div>
        <div class="tab active" data-period="5y">5Y</div>
        <div class="tab" data-period="all">ALL</div>
      </div>
      <div class="stats" id="ratesStats"></div>
      <div class="chart-wrap"><canvas id="ratesChart" height="220"></canvas></div>
    </div>

    <!-- â•â•â• 6. Debt/GDP â•â•â• -->
    <div class="card s5" id="debtCard">
      <div class="card-label">GOVERNMENT DEBT / GDP</div>
      <div class="card-title">ğŸ’³ êµ­ê°€ë¶€ì±„ / GDP</div>
      <div class="card-desc">GDP ëŒ€ë¹„ ì •ë¶€ë¶€ì±„ ë¹„ìœ¨. 100% ì´ˆê³¼ ì‹œ ì¬ì •ê±´ì „ì„± ì£¼ì˜</div>
      <div class="tabs" id="debtTabs">
        <div class="tab active" data-period="10y">10Y</div>
        <div class="tab" data-period="20y">20Y</div>
        <div class="tab" data-period="all">ALL</div>
      </div>
      <div class="stats" id="debtStats"></div>
      <div class="chart-wrap"><canvas id="debtChart" height="220"></canvas></div>
    </div>

    <!-- â•â•â• 7. Global PMI â•â•â• -->
    <div class="card s12" id="pmiCard">
      <div class="card-label">MANUFACTURING PMI</div>
      <div class="card-title">ğŸ­ ê¸€ë¡œë²Œ ì œì¡°ì—… PMI</div>
      <div class="card-desc">ì œì¡°ì—… êµ¬ë§¤ê´€ë¦¬ìì§€ìˆ˜. 50 ì´ìƒ í™•ì¥, ì´í•˜ ìˆ˜ì¶•</div>
      <div class="tabs" id="pmiTabs">
        <div class="tab" data-period="1y">1Y</div>
        <div class="tab active" data-period="3y">3Y</div>
        <div class="tab" data-period="all">ALL</div>
      </div>
      <div class="stats" id="pmiStats"></div>
      <div class="chart-wrap"><canvas id="pmiChart" height="220"></canvas></div>
    </div>

  </div><!-- grid -->

  <footer class="ftr">
    <div>Data: FRED API, OECD, IMF Â· ë§¤ì¼ 07:00 KST ìë™ ì—…ë°ì´íŠ¸</div>
    <div>Built with â™¡ Â· <a href="#">GitHub â†’</a></div>
  </footer>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG & HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DATA_BASE = './data/';
const COLORS = {
  blue:'#4a9eff', cyan:'#00e5cc', red:'#ff4a6a', orange:'#ff8c42',
  yellow:'#ffd642', green:'#42ff8c', purple:'#a855f7',
  us:'#4a9eff', kr:'#00e5cc', eu:'#ffd642', jp:'#ff8c42'
};

Chart.defaults.font.family = "'JetBrains Mono','Noto Sans KR',monospace";
Chart.defaults.font.size = 10;
Chart.defaults.color = '#3a3a52';
Chart.defaults.plugins.legend.display = false;
Chart.defaults.elements.point.radius = 0;
Chart.defaults.elements.point.hoverRadius = 4;
Chart.defaults.elements.line.borderWidth = 2;
Chart.defaults.animation.duration = 600;
Chart.defaults.responsive = true;
Chart.defaults.maintainAspectRatio = false;

const gridColor = 'rgba(255,255,255,0.04)';
const baseScaleOpts = {
  grid:{ color:gridColor, drawBorder:false },
  ticks:{ maxTicksLimit:6, padding:6, font:{size:9} }
};

function makeGradient(ctx, color, h) {
  const g = ctx.createLinearGradient(0,0,0,h);
  g.addColorStop(0, color.replace(')',',0.18)').replace('rgb','rgba'));
  g.addColorStop(1, color.replace(')',',0)').replace('rgb','rgba'));
  return g;
}

function hexToRGBA(hex, a) {
  const r=parseInt(hex.slice(1,3),16), g=parseInt(hex.slice(3,5),16), b=parseInt(hex.slice(5,7),16);
  return `rgba(${r},${g},${b},${a})`;
}

function filterByPeriod(dates, values, period) {
  if(period==='all') return {dates,values};
  const now = new Date();
  const map = {'1m':1,'3m':3,'6m':6,'1y':12,'3y':36,'5y':60,'10y':120,'20y':240};
  const months = map[period] || 60;
  const cutoff = new Date(now); cutoff.setMonth(cutoff.getMonth()-months);
  const filtered = dates.reduce((acc,d,i)=>{
    if(new Date(d)>=cutoff){acc.dates.push(d);acc.values.push(values[i]);}
    return acc;
  },{dates:[],values:[]});
  return filtered;
}

function filterMultiByPeriod(dates, seriesObj, period) {
  if(period==='all') return {dates, series:seriesObj};
  const now=new Date(), map={'1m':1,'3m':3,'6m':6,'1y':12,'3y':36,'5y':60,'10y':120,'20y':240};
  const months=map[period]||60;
  const cutoff=new Date(now); cutoff.setMonth(cutoff.getMonth()-months);
  const out={dates:[],series:{}};
  Object.keys(seriesObj).forEach(k=>out.series[k]=[]);
  dates.forEach((d,i)=>{
    if(new Date(d)>=cutoff){
      out.dates.push(d);
      Object.keys(seriesObj).forEach(k=>out.series[k].push(seriesObj[k][i]));
    }
  });
  return out;
}

async function loadJSON(file) {
  const r = await fetch(DATA_BASE+file);
  return r.json();
}

function setupTabs(containerId, callback) {
  const c = document.getElementById(containerId);
  if(!c) return;
  c.querySelectorAll('.tab').forEach(t=>{
    t.addEventListener('click',()=>{
      c.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
      t.classList.add('active');
      callback(t.dataset.period || t.dataset.mode);
    });
  });
}

const charts = {};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. GLOBAL M2
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let m2Data, m2Mode='total', m2Period='5y';

async function initM2() {
  m2Data = await loadJSON('m2.json');
  renderM2();
  setupTabs('m2ModeTabs', m=>{m2Mode=m; renderM2();});
  setupTabs('m2Tabs', p=>{m2Period=p; renderM2();});
}

function renderM2() {
  const d = m2Data;
  // Stats
  const sh = document.getElementById('m2Stats');
  if(m2Mode==='total') {
    sh.innerHTML = `
      <div class="stat"><div class="stat-val" style="color:var(--cyan)">$${d.total.current_value}T</div><div class="stat-sub">Total Global M2</div></div>
      <div class="stat"><div class="stat-val ${d.total.yoy_pct>=0?'up':'dn'}">${d.total.yoy_pct>=0?'+':''}${d.total.yoy_pct}%</div><div class="stat-sub">YoY</div></div>
    `;
  } else {
    sh.innerHTML = Object.values(d.countries).map(c=>`
      <div class="stat"><div class="stat-flag">${c.flag}</div><div class="stat-chg ${c.yoy_pct>=0?'up':'dn'}">${c.yoy_pct>=0?'+':''}${c.yoy_pct}%</div><div class="stat-sub">${c.name}</div></div>
    `).join('');
  }

  // Chart
  const ctx = document.getElementById('m2Chart').getContext('2d');
  if(charts.m2) charts.m2.destroy();

  if(m2Mode==='total') {
    const f = filterByPeriod(d.total.dates, d.total.values, m2Period);
    charts.m2 = new Chart(ctx, {
      type:'line',
      data:{ labels:f.dates, datasets:[{
        data:f.values, borderColor:COLORS.cyan, backgroundColor:hexToRGBA(COLORS.cyan,0.08),
        fill:true, tension:0.3
      }]},
      options:{ scales:{ x:baseScaleOpts, y:{...baseScaleOpts, ticks:{...baseScaleOpts.ticks, callback:v=>'$'+v+'T'}} } }
    });
  } else {
    const f = filterMultiByPeriod(d.countries.us.dates, {
      us:d.countries.us.values, eu:d.countries.eu.values,
      jp:d.countries.jp.values, kr:d.countries.kr.values
    }, m2Period);
    charts.m2 = new Chart(ctx, {
      type:'line',
      data:{ labels:f.dates, datasets: Object.keys(f.series).map(k=>({
        label:d.countries[k].name, data:f.series[k],
        borderColor:COLORS[k], tension:0.3
      }))},
      options:{ plugins:{legend:{display:true,labels:{boxWidth:10,padding:12,font:{size:10},color:'#6e6e88'}}}, scales:{x:baseScaleOpts, y:{...baseScaleOpts, ticks:{...baseScaleOpts.ticks,callback:v=>'$'+v+'T'}}} }
    });
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. FED BALANCE SHEET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let fedData, fedPeriod='5y';

async function initFed() {
  fedData = await loadJSON('fed_balance_sheet.json');
  renderFed();
  setupTabs('fedTabs', p=>{fedPeriod=p; renderFed();});
}

function renderFed() {
  const d = fedData;
  document.getElementById('fedStats').innerHTML = `
    <div class="stat"><div class="stat-val" style="color:var(--blue);font-family:'Bebas Neue',sans-serif;font-size:32px;">$${d.current_value}T</div><div class="stat-sub">Total Assets</div></div>
    <div class="stat"><div class="stat-chg ${d.weekly_change>=0?'up':'dn'}">${d.weekly_change>=0?'+':''}$${(d.weekly_change*1000).toFixed(0)}B/wk</div><div class="stat-sub">ì£¼ê°„ ë³€ë™</div></div>
  `;
  const f = filterByPeriod(d.dates, d.values, fedPeriod);
  const ctx = document.getElementById('fedChart').getContext('2d');
  if(charts.fed) charts.fed.destroy();
  charts.fed = new Chart(ctx, {
    type:'line',
    data:{ labels:f.dates, datasets:[{
      data:f.values, borderColor:COLORS.blue, backgroundColor:hexToRGBA(COLORS.blue,0.08),
      fill:true, tension:0.3
    }]},
    options:{ scales:{ x:baseScaleOpts, y:{...baseScaleOpts, ticks:{...baseScaleOpts.ticks, callback:v=>'$'+v+'T'}} } }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3. YIELD CURVE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function initYC() {
  const d = await loadJSON('yield_curve.json');
  const ctx = document.getElementById('ycChart').getContext('2d');
  charts.yc = new Chart(ctx, {
    type:'line',
    data:{
      labels: d.current.maturities,
      datasets:[
        { label:'í˜„ì¬', data:d.current.rates, borderColor:COLORS.orange, backgroundColor:hexToRGBA(COLORS.orange,0.06), fill:true, tension:0.3, pointRadius:4, pointHoverRadius:6, pointBackgroundColor:COLORS.orange },
        { label:'1ë…„ ì „', data:d.one_year_ago.rates, borderColor:hexToRGBA(COLORS.purple,0.4), borderDash:[6,4], tension:0.3, pointRadius:0 }
      ]
    },
    options:{ scales:{ x:{...baseScaleOpts, ticks:{...baseScaleOpts.ticks, maxTicksLimit:11}}, y:{...baseScaleOpts, ticks:{...baseScaleOpts.ticks, callback:v=>v.toFixed(1)+'%'}} } }
  });

  // Spreads
  const sp = d.spreads;
  const statusClass = s => s==='INVERTED'?'badge-red':s==='FLAT'?'badge-yellow':'badge-green';
  const statusKr = s => s==='INVERTED'?'ì—­ì „':s==='FLAT'?'í”Œë«':'ì •ìƒ';
  document.getElementById('ycSpreads').innerHTML = `
    <div class="spread-item"><div class="spread-val" style="color:var(--orange)">${sp['2s10s']>=0?'+':''}${(sp['2s10s']*100).toFixed(0)}bp</div><div class="spread-name">2s10s</div></div>
    <div class="spread-item"><div class="spread-val" style="color:var(--purple)">${sp['3m10y']>=0?'+':''}${(sp['3m10y']*100).toFixed(0)}bp</div><div class="spread-name">3m10y</div></div>
    <span class="badge ${statusClass(sp['2s10s_status'])}">${statusKr(sp['2s10s_status'])}</span>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4. NFCI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let nfciData, nfciPeriod='3y';

async function initNFCI() {
  nfciData = await loadJSON('nfci.json');
  renderNFCI();
  setupTabs('nfciTabs', p=>{nfciPeriod=p; renderNFCI();});
}

function renderNFCI() {
  const d = nfciData;
  const isLoose = d.current_value < 0;
  document.getElementById('nfciStats').innerHTML = `
    <div class="stat"><div class="stat-val" style="color:var(--${isLoose?'green':'red'}); font-family:'Bebas Neue',sans-serif; font-size:32px;">${d.current_value}</div><div class="stat-sub">NFCI Index</div></div>
    <div class="stat"><span class="badge ${isLoose?'badge-green':'badge-red'}">${d.status}</span><div class="stat-sub" style="margin-top:4px">0 ì´ìƒ=ê¸´ì¶• / ì´í•˜=ì™„í™”</div></div>
  `;

  const f = filterByPeriod(d.dates, d.values, nfciPeriod);
  const ctx = document.getElementById('nfciChart').getContext('2d');
  if(charts.nfci) charts.nfci.destroy();

  // Color segments: green below 0, red above 0
  charts.nfci = new Chart(ctx, {
    type:'line',
    data:{ labels:f.dates, datasets:[{
      data:f.values,
      borderColor: f.values.map(v=>v>=0?COLORS.red:COLORS.green),
      segment:{ borderColor: ctx2 => {
        const v = ctx2.p1.parsed.y;
        return v >= 0 ? COLORS.red : COLORS.green;
      }},
      tension:0.3, fill:false
    }]},
    options:{
      scales:{
        x:baseScaleOpts,
        y:{...baseScaleOpts, ticks:{...baseScaleOpts.ticks}}
      },
      plugins:{
        annotation: false
      }
    },
    plugins:[{
      id:'zeroLine',
      afterDraw(chart) {
        const y = chart.scales.y.getPixelForValue(0);
        const ctx = chart.ctx;
        ctx.save();
        ctx.strokeStyle = 'rgba(255,255,255,0.15)';
        ctx.lineWidth = 1;
        ctx.setLineDash([4,4]);
        ctx.beginPath(); ctx.moveTo(chart.chartArea.left,y); ctx.lineTo(chart.chartArea.right,y); ctx.stroke();
        ctx.restore();
        // Labels
        ctx.fillStyle='rgba(66,255,140,0.4)'; ctx.font='9px JetBrains Mono';
        ctx.fillText('ì™„í™”',chart.chartArea.right-24,y+12);
        ctx.fillStyle='rgba(255,74,106,0.4)';
        ctx.fillText('ê¸´ì¶•',chart.chartArea.right-24,y-6);
      }
    }]
  });

  const interp = document.getElementById('nfciInterp');
  if(isLoose) {
    interp.className = 'interp interp-green';
    interp.innerHTML = `<strong>í˜„ì¬: ì™„í™”ì  í™˜ê²½ (${d.current_value})</strong> â€” ìœ ë™ì„±ì´ í’ë¶€í•˜ê³  ì‹œì¥ ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ë‚®ì€ ìƒíƒœ`;
  } else {
    interp.className = 'interp interp-red';
    interp.innerHTML = `<strong>í˜„ì¬: ê¸´ì¶•ì  í™˜ê²½ (${d.current_value})</strong> â€” ê¸ˆìœµí™˜ê²½ì´ íƒ€ì´íŠ¸í•˜ê³  ì‹œì¥ì— ì••ë ¥ì´ ìˆëŠ” ìƒíƒœ`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 5. INTEREST RATES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let ratesData, ratesPeriod='5y';

async function initRates() {
  ratesData = await loadJSON('rates.json');
  renderRates();
  setupTabs('ratesTabs', p=>{ratesPeriod=p; renderRates();});
}

function renderRates() {
  const d = ratesData;
  const keys = ['us','kr','eu','jp'];
  document.getElementById('ratesStats').innerHTML = keys.map(k=>{
    const c = d.countries[k];
    const chgStr = c.prev_change > 0 ? `â–² +${(c.prev_change*100).toFixed(0)}bp` : c.prev_change < 0 ? `â–¼ ${(c.prev_change*100).toFixed(0)}bp` : 'â€” ë™ê²°';
    const chgClass = c.prev_change>0?'up':c.prev_change<0?'dn':'flat';
    return `<div class="stat"><div class="stat-flag">${c.flag}</div><div class="stat-val" style="color:${COLORS[k]};font-size:18px;">${c.current}%</div><div class="stat-chg ${chgClass}">${chgStr}</div><div class="stat-sub">${c.name} ${c.bank}</div></div>`;
  }).join('');

  const f = filterMultiByPeriod(d.dates, d.series, ratesPeriod);
  const ctx = document.getElementById('ratesChart').getContext('2d');
  if(charts.rates) charts.rates.destroy();
  charts.rates = new Chart(ctx, {
    type:'line',
    data:{ labels:f.dates, datasets:keys.map(k=>({
      label:d.countries[k].name, data:f.series[k],
      borderColor:COLORS[k], tension:0, stepped:'before'
    }))},
    options:{
      plugins:{legend:{display:true,labels:{boxWidth:10,padding:12,font:{size:10},color:'#6e6e88'}}},
      scales:{x:baseScaleOpts, y:{...baseScaleOpts, ticks:{...baseScaleOpts.ticks, callback:v=>v+'%'}}}
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 6. DEBT / GDP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let debtData, debtPeriod='10y';

async function initDebt() {
  debtData = await loadJSON('debt_gdp.json');
  renderDebt();
  setupTabs('debtTabs', p=>{debtPeriod=p; renderDebt();});
}

function renderDebt() {
  const d = debtData;
  const keys = ['us','kr','eu','jp'];
  document.getElementById('debtStats').innerHTML = keys.map(k=>{
    const c = d.countries[k];
    const cls = c.current>=100?'dn':c.current>=80?'':'up';
    return `<div class="stat"><div class="stat-flag">${c.flag}</div><div class="stat-val ${cls}" style="font-size:18px;">${c.current}%</div><div class="stat-sub">${c.name}</div></div>`;
  }).join('');

  const f = filterMultiByPeriod(d.dates, d.series, debtPeriod);
  const ctx = document.getElementById('debtChart').getContext('2d');
  if(charts.debt) charts.debt.destroy();
  charts.debt = new Chart(ctx, {
    type:'line',
    data:{ labels:f.dates, datasets:keys.map(k=>({
      label:d.countries[k].name, data:f.series[k],
      borderColor:COLORS[k], tension:0.3
    }))},
    options:{
      plugins:{legend:{display:true,labels:{boxWidth:10,padding:12,font:{size:10},color:'#6e6e88'}}},
      scales:{x:baseScaleOpts, y:{...baseScaleOpts, ticks:{...baseScaleOpts.ticks, callback:v=>v+'%'}}}
    },
    plugins:[{
      id:'line100',
      afterDraw(chart) {
        const y = chart.scales.y.getPixelForValue(100);
        if(y < chart.chartArea.top || y > chart.chartArea.bottom) return;
        const ctx = chart.ctx;
        ctx.save();
        ctx.strokeStyle = 'rgba(255,74,106,0.3)';
        ctx.lineWidth = 1;
        ctx.setLineDash([4,4]);
        ctx.beginPath(); ctx.moveTo(chart.chartArea.left,y); ctx.lineTo(chart.chartArea.right,y); ctx.stroke();
        ctx.fillStyle='rgba(255,74,106,0.4)'; ctx.font='9px JetBrains Mono';
        ctx.fillText('100%',chart.chartArea.right-28,y-5);
        ctx.restore();
      }
    }]
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 7. GLOBAL PMI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let pmiData, pmiPeriod='3y';

async function initPMI() {
  pmiData = await loadJSON('pmi.json');
  renderPMI();
  setupTabs('pmiTabs', p=>{pmiPeriod=p; renderPMI();});
}

function renderPMI() {
  const d = pmiData;
  const keys = ['us','kr','eu','jp'];
  document.getElementById('pmiStats').innerHTML = keys.map(k=>{
    const c = d.countries[k];
    const above = c.current >= 50;
    const chgStr = c.prev_change>=0?`â–² +${c.prev_change}`:`â–¼ ${c.prev_change}`;
    return `<div class="stat">
      <div class="stat-flag">${c.flag}</div>
      <div class="stat-val ${above?'up':'dn'}" style="font-size:20px;">${c.current}</div>
      <div class="stat-chg ${above?'up':'dn'}">${chgStr}</div>
      <div class="stat-sub">${c.name}</div>
    </div>`;
  }).join('');

  const f = filterMultiByPeriod(d.dates, d.series, pmiPeriod);
  const ctx = document.getElementById('pmiChart').getContext('2d');
  if(charts.pmi) charts.pmi.destroy();
  charts.pmi = new Chart(ctx, {
    type:'line',
    data:{ labels:f.dates, datasets:keys.map(k=>({
      label:d.countries[k].name, data:f.series[k],
      borderColor:COLORS[k], tension:0.3
    }))},
    options:{
      plugins:{legend:{display:true,labels:{boxWidth:10,padding:12,font:{size:10},color:'#6e6e88'}}},
      scales:{x:baseScaleOpts, y:{...baseScaleOpts, ticks:{...baseScaleOpts.ticks}}}
    },
    plugins:[{
      id:'line50',
      afterDraw(chart) {
        const y = chart.scales.y.getPixelForValue(50);
        if(y < chart.chartArea.top || y > chart.chartArea.bottom) return;
        const ctx = chart.ctx;
        ctx.save();
        ctx.strokeStyle = 'rgba(255,255,255,0.12)';
        ctx.lineWidth = 1;
        ctx.setLineDash([4,4]);
        ctx.beginPath(); ctx.moveTo(chart.chartArea.left,y); ctx.lineTo(chart.chartArea.right,y); ctx.stroke();
        ctx.fillStyle='rgba(66,255,140,0.3)'; ctx.font='9px JetBrains Mono';
        ctx.fillText('í™•ì¥',chart.chartArea.right-24,y-6);
        ctx.fillStyle='rgba(255,74,106,0.3)';
        ctx.fillText('ìˆ˜ì¶•',chart.chartArea.right-24,y+12);
        ctx.restore();
      }
    }]
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT ALL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function init() {
  try {
    await Promise.all([initM2(), initFed(), initYC(), initNFCI(), initRates(), initDebt(), initPMI()]);
  } catch(e) {
    console.error('Dashboard init error:', e);
  }
  // iframe auto-resize
  sendHeight();
  window.addEventListener('resize', sendHeight);
  new MutationObserver(sendHeight).observe(document.body,{childList:true,subtree:true});
}

function sendHeight() {
  const h = document.documentElement.scrollHeight;
  window.parent.postMessage({type:'resize', height:h},'*');
}

init();
</script>
</body>
</html>
